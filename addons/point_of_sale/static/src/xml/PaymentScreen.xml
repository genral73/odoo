<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="PaymentScreenElectronicPayment" owl="1">
        <div class="paymentline electronic_payment">
            <t t-if="props.line.payment_status == 'pending'">
                <div>
                    Payment request pending
                </div>
                <div class="button send_payment_request highlight" title="Send Payment Request"
                     t-att-data-cid="props.line.cid">
                    Send
                </div>
            </t>
            <t t-elif="props.line.payment_status == 'retry'">
                <div>
                    Transaction cancelled
                </div>
                <div class="button send_payment_request highlight" title="Send Payment Request"
                     t-att-data-cid="props.line.cid">
                    Retry
                </div>
            </t>
            <t t-elif="props.line.payment_status == 'force_done'">
                <div>
                    Connection error
                </div>
                <div class="button send_force_done" title="Force Done"
                     t-att-data-cid="props.line.cid">
                    Force done
                </div>
            </t>
            <t t-elif="props.line.payment_status == 'waitingCard'">
                <div>
                    Waiting for card
                </div>
                <div class="button send_payment_cancel" title="Cancel Payment Request"
                     t-att-data-cid="props.line.cid">
                    Cancel
                </div>
            </t>
            <t t-elif="['waiting', 'waitingCancel'].includes(props.line.payment_status)">
                <div>
                    Request sent
                </div>
                <div>
                    <i class="fa fa-spinner fa-spin" role="img" />
                </div>
            </t>
            <t t-elif="props.line.payment_status == 'reversing'">
                <div>
                    Reversal request sent to terminal
                </div>
                <div>
                    <i class="fa fa-spinner fa-spin" role="img" />
                </div>
            </t>
            <t t-elif="props.line.payment_status == 'done'">
                <t t-if="props.line.can_be_reversed">
                    <div>
                        Payment Successful
                    </div>
                    <div class="button send_payment_reversal" title="Reverse Payment"
                         t-att-data-cid="props.line.cid">
                        Reverse
                    </div>
                </t>
                <t t-else="">
                    <div>
                        Payment Successful
                    </div>
                    <div></div>
                </t>
            </t>
            <t t-elif="props.line.payment_status == 'reversed'">
                <div class="paymentline electronic_payment">
                    <div>
                        Payment reversed
                    </div>
                    <div></div>
                </div>
            </t>
        </div>
    </t>

    <t t-name="PaymentScreenPaymentLines" owl="1">
        <div t-if="props.paymentLines.length === 0" class="paymentlines-empty">
            <div class="total">
                <t t-esc="totalDueText" />
            </div>
            <div class="message">
                Please select a payment method.
            </div>
        </div>

        <div t-else="">
            <div class="payment-status-container">
                <div>
                    <div class="payment-status-remaining">
                        <span class="label">Remaining</span>
                        <span class="amount"
                              t-att-class="{ highlight: currentOrder.get_due() > 0 }">
                            <t t-esc="remainingText" />
                        </span>
                    </div>
                    <div class="payment-status-total-due">
                        <span class="label">Total Due</span>
                        <span>
                            <t t-esc="totalDueText" />
                        </span>
                    </div>
                </div>
                <div>
                    <div class="payment-status-change">
                        <span class="label">Change</span>
                        <span class="amount"
                              t-att-class="{ highlight: currentOrder.get_change() > 0 }">
                            <t t-esc="changeText" />
                        </span>
                    </div>
                </div>
            </div>
            <hr />
            <div class="paymentlines">
                <div class="paymentline heading">
                    <div>Tendered</div>
                    <div>Method</div>
                    <div></div>
                </div>
                <div class="body">
                    <t t-foreach="props.paymentLines" t-as="line" t-key="line.cid">
                        <t t-if="line.selected">
                            <div class="paymentline selected"
                                 t-att-class="{ 'payment-terminal': line.get_payment_status() }"
                                 t-on-click="trigger('select-payment-line', { cid: line.cid })">
                                <t
                                   t-if="line and line.payment_status and ['done', 'waitingCard', 'waiting', 'reversing', 'reversed'].includes(line.payment_status)">
                                    <div class="col-tendered">
                                        <t
                                           t-esc="props.pos.format_currency_no_symbol(line.get_amount())" />
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="col-tendered edit">
                                        <t t-esc="formattedInputBuffer" />
                                    </div>
                                </t>
                                <div class="col-name">
                                    <t t-esc="line.payment_method.name" />
                                </div>
                                <t
                                   t-if="line and line.payment_status and ['done', 'reversed', 'reversing'].includes(line.payment_status)">
                                    <div />
                                </t>
                                <t t-else="">
                                    <div class="delete-button"
                                         t-on-click="trigger('delete-payment-line', { cid: line.cid })"
                                         aria-label="Delete" title="Delete">
                                        <i class="fa fa-times-circle" />
                                    </div>
                                </t>
                            </div>
                            <!-- <t t-if="line and line.payment_status">
                                <PaymentScreenElectronicPayment line="line" />
                            </t> -->
                        </t>
                        <t t-else="">
                            <div class="paymentline"
                                 t-on-click="trigger('select-payment-line', { cid: line.cid })">
                                <div class="col-tendered">
                                    <t
                                       t-esc="props.pos.format_currency_no_symbol(line.get_amount())" />
                                </div>
                                <div class="col-name">
                                    <t t-esc="line.payment_method.name" />
                                </div>
                                <t
                                   t-if="line and line.payment_status and ['done', 'reversed', 'reversing'].includes(line.payment_status)">
                                    <div />
                                </t>
                                <t t-else="">
                                    <div class="delete-button"
                                         t-on-click="trigger('delete-payment-line', { cid: line.cid })"
                                         aria-label="Delete" title="Delete">
                                        <i class="fa fa-times-circle" />
                                    </div>
                                </t>
                            </div>
                        </t>
                    </t>
                </div>
            </div>
        </div>
    </t>

    <t t-name="PSNumpadInputButton" owl="1">
        <button t-attf-class="{{ _class }}"
                t-on-click="trigger('input-from-numpad', { value: props.value })">
            <t t-slot="default">
                <t t-if="props.text">
                    <t t-esc="props.text" />
                </t>
                <t t-else="">
                    <t t-esc="props.value" />
                </t>
            </t>
        </button>
    </t>

    <t t-name="PaymentScreenNumpad" owl="1">
        <div class="numpad">
            <PSNumpadInputButton value="'1'" />
            <PSNumpadInputButton value="'2'" />
            <PSNumpadInputButton value="'3'" />
            <PSNumpadInputButton value="'+10'" changeClassTo="'mode-button'" />
            <br />
            <PSNumpadInputButton value="'4'" />
            <PSNumpadInputButton value="'5'" />
            <PSNumpadInputButton value="'6'" />
            <PSNumpadInputButton value="'+20'" changeClassTo="'mode-button'" />
            <br />
            <PSNumpadInputButton value="'7'" />
            <PSNumpadInputButton value="'8'" />
            <PSNumpadInputButton value="'9'" />
            <PSNumpadInputButton value="'+50'" changeClassTo="'mode-button'" />
            <br />
            <PSNumpadInputButton value="'-'" text="'+/-'" />
            <PSNumpadInputButton value="'0'" />
            <PSNumpadInputButton value="props.decimalPoint" />
            <PSNumpadInputButton value="'BACKSPACE'">
                <img src="/point_of_sale/static/src/img/backspace.png" width="24" height="21"
                     alt="Backspace" />
            </PSNumpadInputButton>
        </div>
    </t>

    <t t-name="PaymentMethodButton" owl="1">
        <div class="button paymentmethod" t-on-click="trigger('new-payment-line')">
            <t t-esc="props.paymentMethod.name" />
        </div>
    </t>

    <t t-name="PaymentScreen" owl="1">
        <div class="payment-screen screen">
            <div class="screen-content">
                <div class="top-content">
                    <span class="button back"
                          t-on-click="trigger('show-screen', { name: 'ProductScreen' })">
                        <i class="fa fa-angle-double-left"></i>
                        Back
                    </span>
                    <h1>Payment</h1>
                    <span class="button next" t-att-class="{ highlight: currentOrder.is_paid() }"
                          t-on-click="validateOrder">
                        Validate
                        <i class="fa fa-angle-double-right"></i>
                    </span>
                </div>
                <div class="left-content pc40 touch-scrollable scrollable-y">
                    <div class="paymentmethods-container">
                        <div class="paymentmethods">
                            <t t-foreach="pos.payment_methods" t-as="paymentMethod"
                               t-key="paymentMethod.id">
                                <PaymentMethodButton paymentMethod="paymentMethod"
                                                     t-on-new-payment-line="addNewPaymentLine(paymentMethod)" />
                            </t>
                        </div>
                    </div>
                </div>
                <div class="right-content pc60 touch-scrollable scrollable-y">

                    <section class="paymentlines-container"
                             t-on-delete-payment-line="deletePaymentLine"
                             t-on-select-payment-line="selectPaymentLine">
                        <PaymentScreenPaymentLines pos="pos" paymentLines="paymentLines"
                                                   inputBuffer="inputBuffer" />
                    </section>

                    <section class="payment-numpad">
                        <PaymentScreenNumpad decimalPoint="decimalPoint"
                                             t-on-input-from-numpad="inputFromNumpad" />
                    </section>

                    <div class="payment-buttons">
                        <div class="button js_set_customer">
                            <i class="fa fa-user" role="img" aria-label="Customer"
                               title="Customer" />
                            <span class="js_customer_name">
                                <t t-if="pos.get_client()">
                                    <t t-esc="pos.get_client().name" />
                                </t>
                                <t t-if="!pos.get_client()">
                                    Customer
                                </t>
                            </span>
                        </div>
                        <div t-if="pos.config.module_account" class="button js_invoice"
                             t-att-class="{ highlight: currentOrder.is_to_invoice() }"
                             t-on-click="toggleIsToInvoice">
                            <i class="fa fa-file-text-o" /> Invoice
                        </div>
                        <div class="button js_email"
                             t-att-class="{ highlight: currentOrder.is_to_email() }"
                             t-on-click="toggleIsToEmail">
                            <i class="fa fa-inbox" /> Email
                        </div>
                        <div t-if="pos.config.tip_product_id" class="button js_tip"
                             t-on-click="addTip">
                            <i class="fa fa-heart" /> Tip
                        </div>
                        <div t-if="pos.config.iface_cashdrawer" class="button js_cashdrawer"
                             t-on-click="openCashbox">
                            <i class="fa fa-archive" /> Open Cashbox
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>
